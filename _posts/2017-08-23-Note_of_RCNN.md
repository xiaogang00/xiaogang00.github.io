---
layout: post
title: Learning note for RCNN
category: Computer Vision
tags: computer_vision
---

* content
{:toc}


Region CNN(RCNN)可以说是利用深度学习进行目标检测的开山之作。作者Ross Girshick多次在PASCAL VOC的目标检测竞赛中折桂，2010年更带领团队获得终身成就奖，如今供职于Facebook旗下的FAIR。 

### 主要的思想

主要的思想在于解决以下两个问题：

#### 速度的问题

经典的目标检测算法使用滑动窗法依次判断所有可能的区域。本文则预先提取一系列较可能是物体的候选区域，之后仅在这些候选区域上提取特征，进行判断。

#### 训练集的问题

经典的目标检测算法在区域中提取人工设定的特征。本文则需要训练深度网络进行特征提取。可供使用的有两个数据库： 

1. 一个较大的**识别库**（ImageNet ILSVC 2012）：标定每张图片中物体的类别。一千万图像，1000类。 
2. 一个较小的**检测库**（PASCAL VOC 2007）：标定每张图片中，物体的类别和位置。一万图像，20类。 

本文使用识别库进行预训练，而后用检测库调优参数。最后在检测库上评测。



### 主要的算法流程

RCNN算法分为4个步骤 

- 一张图像生成1K~2K个**候选区域** 

- 对每个候选区域，使用深度网络**提取特征** 

- 特征送入每一类的SVM **分类器**，判别是否属于该类 

- 使用回归器**精细修正**候选框位置 

  ​

#### 候选区域

使用了Selective Search[1](http://blog.csdn.net/shenxiaolu1984/article/details/51066975#fn:1)方法从一张图像生成约2000-3000个候选区域。基本思路如下： 

- 使用一种过分割手段，将图像分割成小区域 

- 查看现有小区域，合并**可能性最高**的两个区域。重复直到整张图像合并成一个区域位置 

- 输出所有曾经存在过的区域，所谓候选区域

  ​

#### 特征提取

在预训练的时候，使用深度网络提取特征之前，首先把候选区域归一化成同一尺寸$227\times 227$。 此处有一些细节可做变化：外扩的尺寸大小，形变时是否保持原比例，对框外区域直接截取还是补灰。会轻微影响性能。使用ILVCR 2012的全部数据进行训练，输入一张图片，输出1000维的类别标号。

之后进行调优训练，同样使用上述网络，最后一层换成$4096 \rightarrow21$的全连接网络。 学习率0.001，每一个batch包含32个正样本（属于20类）和96个背景。考察一个候选框和当前图像上所有标定框重叠面积最大的一个。如果重叠比例大于0.5，则认为此候选框为此标定的类别；否则认为此候选框为背景。



#### 分类

对每一类目标，使用一个线性SVM二类分类器进行判别。输入为深度网络输出的4096维特征，输出是否属于此类。 由于负样本很多，使用hard negative mining方法。在这之后还需要用回归器等方法进行修正。对每一类目标，使用一个线性脊回归器进行精修。正则项$\lambda=10000$。 输入为深度网络pool5层的4096维特征，输出为xy方向的缩放和平移。 

